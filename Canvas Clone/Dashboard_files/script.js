const ee=window.ENV?.current_context?.id||"";let te,ae,ne=!1;const ie=new class{key;constructor(ee){this.key=ee}get(){const ee=localStorage.getItem(this.key);if(!ee)return null;try{return JSON.parse(ee)}catch{return null}}update(ee){const te={...this.get()||{},...ee};localStorage.setItem(this.key,JSON.stringify(te))}replace(ee){localStorage.setItem(this.key,JSON.stringify(ee))}clear(){localStorage.removeItem(this.key)}}("MAIZEY_CONFIG"),re={sidebar:{url:"https://assets.umgpt.umich.edu/canvas/sidebar.html",title:"Maizey Sidebar",id:"maizey-iframe",styles:{height:"100vh",width:"400px",background:"#fff",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1)",display:"flex",flexDirection:"column",zIndex:"9999",border:"none"}}};async function oe(){if(!ee)return!1;const te=`https://canvas-prod.api.umgpt.umich.edu/api/maizey/instance/annarbor/courses/${ee}/`;try{const ee=await fetch(te,{method:"GET",headers:{"Content-Type":"application/json"}});if(!ee.ok)return!1;const ne=await ee.json();return ae={id:ne.project_id,name:ne.project_name,slug:ne.project_slug,detailUrl:ne.project_detail_url,qaUrl:ne.project_qa_url},!0}catch(ne){return console.error("ðŸ› ï¸ Maizey Sidebar: Error checking for Maizey project",ne),!1}}async function se(){const te=`https://umich.instructure.com/api/v1/courses/${ee}`,ae=await fetch(te);return ae.ok?await ae.json():(console.error("ðŸ› ï¸ Maizey Sidebar: Failed to fetch course info"),null)}function ce(){const ee=document.getElementById(re.sidebar.id);ee&&ee.remove(),ie.update({sidebarOpen:!1}),console.debug("ðŸ› ï¸ Maizey Sidebar: iframe removed")}async function de(){te||(te=await se()),ne||(ne=await oe()),te&&ne?(!function(){if(document.getElementById(re.sidebar.id))return void console.debug("ðŸ› ï¸ Maizey Sidebar: iframe already injected, skipping.");const ee=document.createElement("iframe");ee.id=re.sidebar.id,ee.src=re.sidebar.url,ee.title=re.sidebar.title,Object.assign(ee.style,re.sidebar.styles);const te=document.getElementById("application");te&&(te.style.flex="1",te.style.margin="0",te.style.overflow="auto",te.style.maxHeight="100dvh",document.body.style.display="flex",te.insertAdjacentElement("afterend",ee),console.debug("ðŸ› ï¸ Maizey Sidebar: iframe injected"))}(),ie.update({sidebarOpen:!0})):(console.error("ðŸ› ï¸ Maizey Sidebar: Maizey is not enabled for this course."),ce())}!async function(){const ee=document.querySelector(".context_external_tool_62440");ee?.addEventListener("click",async ae=>{ae.preventDefault(),ae.stopPropagation(),te=await se(),ne=await oe(),te&&ne?de():(console.debug("ðŸ› ï¸ Maizey Sidebar: Failed to bootstrap"),window.open(ee?.href,"_blank","noopener,noreferrer"))}),ie.get()?.sidebarOpen&&(console.debug("ðŸ› ï¸ Maizey Sidebar: restoring..."),de())}(),window.addEventListener("message",async ee=>{if("CLOSE_SIDEBAR"===ee.data.type&&ce(),"RESIZE_SIDEBAR"===ee.data.type){const te=document.getElementById(re.sidebar.id);te&&(te.style.width=`${ee.data.value.width}px`)}if("REQUEST_COURSE_INFO"==ee.data.type){const ee=document.getElementById(re.sidebar.id);ee&&ee.contentWindow&&null!=te&&null!=ae&&ee.contentWindow.postMessage({type:"COURSE_INFO",value:{id:te.id,name:te.name,roles:te.enrollments.map(ee=>ee.role),project:ae}},"https://assets.umgpt.umich.edu/canvas/sidebar.html")}},!1);
